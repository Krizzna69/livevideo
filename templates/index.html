<!DOCTYPE html>
<html>
<head>
    <title>Mobile Camera Stream</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
</head>
<body>
    <h2>Live Video Streaming from Mobile</h2>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        const socket = io();  // Connect to Flask WebSocket server

        async function startStreaming() {
            const video = document.getElementById("video");
            const stream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = stream;

            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            function sendFrame() {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                const imageData = canvas.toDataURL("image/jpeg");
                socket.emit('frame', imageData);  // Send frame via WebSocket

                requestAnimationFrame(sendFrame);
            }
            sendFrame();
        }

        startStreaming();
    </script>
</body>
</html>
